<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SHAP Explanation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { color: #333; }
        #shap-container { margin-top: 20px; }
        img { max-width: 600px; height: auto; border: 1px solid #ccc; padding: 5px; }
        .feature-list { margin-top: 20px; }
        .feature-list li { margin-bottom: 5px; }
    </style>
</head>
<body>
    <h2>Prediction & SHAP Explanation</h2>

    <div>
        <strong>Predicted Label:</strong> <span id="predicted-label">-</span>
    </div>

    <div id="shap-container">
        <h3>SHAP Feature Contributions</h3>
        <img id="shap-plot" src="" alt="SHAP plot will appear here" />
    </div>

    <div class="feature-list">
        <h3>Top Contributing Features</h3>
        <ul id="top-features"></ul>
    </div>

    <script>
        // Example payload - you can get this dynamically from a form
        const payload = {
            "Moisture": 7.5735,
            "Ash": 1.3274,
            "Volatile_Oil": 2.0912,
            "Acid_Insoluble_Ash": 0.1618,
            "Chromium": 0.4303,
            "Coumarin": 0.3628,
            "Fiber": 10.7924, 
            "Density": 0.9128, 
            "Oil_Content": 6.0225, 
            "Resin": 2.3581, 
            "Pesticide_Level": 0.0131, 
            "PH_Value": 5.9010
        };

        fetch('/predict_shap', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
                return;
            }

            // Set predicted label
            document.getElementById('predicted-label').innerText = data.predicted_label;

            // Set SHAP plot
            document.getElementById('shap-plot').src = 'data:image/png;base64,' + data.shap_plot_base64;

            // Populate top contributors
            const topFeaturesUl = document.getElementById('top-features');
            topFeaturesUl.innerHTML = '';
            data.top_contributors.forEach(item => {
                const li = document.createElement('li');
                li.innerText = `${item.feature}: SHAP = ${item.shap_value.toFixed(4)}`;
                topFeaturesUl.appendChild(li);
            });
        })
        .catch(err => console.error(err));
    </script>
</body>
</html>
